# ?? H??ng d?n Tr?c quan: ??ng Nh?p B?t Bu?c

## ?? S? ?? Quy trình (Flow Diagram)

### Tr??c ?ây ?
```
User Type URL
    ?
http://localhost/
    ?
? Hi?n th? Dashboard ngay
  (Không c?n ??ng nh?p)
    ?
? Ai c?ng có th? truy c?p m?i th?
```

### Bây gi? ?
```
User Type URL
    ?
http://localhost/
    ?
System Ki?m Tra Session
    ?
CustomerId = null ?
    ? (YES)
? Chuy?n t?i /Account/Login
    ?
User ??ng Nh?p
    ?
Ki?m tra Email/Username + Password
    ?
Credentials OK?
    ? (YES)
Set Session: CustomerId, CustomerName, CustomerEmail
    ?
? Chuy?n t?i /Home/Index
    ?
? Hi?n th? Dashboard (?ã xác th?c)
    ?
User s? d?ng h? th?ng
```

---

## ?? Mô hình b?o m?t (Security Model)

```
???????????????????????????????????????????????????????
?           NG??I DÙNG CH?A ??NG NH?P                 ?
?                                                     ?
?  ?? Trang Ch? .......................... ? B? ch?n ?
?  ?? Qu?n Lý Khách Hàng ................ ? B? ch?n ?
?  ?? Qu?n Lý S?n Ph?m .................. ? B? ch?n ?
?  ?? Qu?n Lý Gi? Hàng .................. ? B? ch?n ?
?  ?? Qu?n Lý Hóa ??n ................... ? B? ch?n ?
?  ?? Qu?n Lý Thanh Toán ................ ? B? ch?n ?
?  ?                                                 ?
?  ?? ??ng Nh?p ......................... ? Cho phép ?
?  ?? ??ng Ký ........................... ? Cho phép ?
?                                                     ?
???????????????????????????????????????????????????????
            ?
        ??NG NH?P THÀNH CÔNG
            ?
???????????????????????????????????????????????????????
?        NG??I DÙNG ?Ã ??NG NH?P (Authenticated)    ?
?                                                     ?
?  ?? Trang Ch? .......................... ? Cho phép ?
?  ?? Qu?n Lý Khách Hàng ................ ? Cho phép ?
?  ?? Qu?n Lý S?n Ph?m .................. ? Cho phép ?
?  ?? Qu?n Lý Gi? Hàng .................. ? Cho phép ?
?  ?? Qu?n Lý Hóa ??n ................... ? Cho phép ?
?  ?? Qu?n Lý Thanh Toán ................ ? Cho phép ?
?  ?? Dashboard Khách Hàng .............. ? Cho phép ?
?  ?                                                 ?
?  ?? ??ng Xu?t ......................... ? Cho phép ?
?                                                     ?
???????????????????????????????????????????????????????
            ?
        ??NG XU?T
            ?
      QUAY L?I TR?NG THÁI CH?A ??NG NH?P
```

---

## ?? Vòng ??i Session (Session Lifecycle)

```
1. USER OPENS APP
   |
   ??? Session doesn't exist
   |   (CustomerId = null)
   |
   ??? HomeController.Index() checks
   |   if (customerId == null)
   |
   ??? Redirect to /Account/Login

2. LOGIN PAGE
   |
   ??? User enters credentials
   |
   ??? Verify username/email + password
   |
   ??? Credentials correct?
       |
       ?? YES ? Set Session Variables
       |        CustomerId = 1
       |        CustomerName = "John Doe"
       |        CustomerEmail = "john@example.com"
       |
       ?? NO ? Show error message
               Stay on login page

3. SESSION CREATED
   |
   ??? Redirect to /Home/Index
   |
   ??? HomeController.Index() checks
   |   if (customerId != null) ?
   |
   ??? Show Dashboard

4. USER USING APP
   |
   ??? Session is active
   |   (Valid for 30 minutes of inactivity)
   |
   ??? Can access all management pages
   |
   ??? Can click logout anytime

5. LOGOUT
   |
   ??? HttpContext.Session.Clear()
   |   (Session variables deleted)
   |
   ??? Redirect to /Account/Login
   |
   ??? Back to LOGIN PAGE (Step 2)

6. SESSION TIMEOUT
   |
   ??? 30 minutes of inactivity
   |   (User hasn't interacted with app)
   |
   ??? Session expires automatically
   |
   ??? Next page access checks session
   |
   ??? Session expired ? Redirect to login
```

---

## ?? Code Architecture (Ki?n trúc Code)

### HomeController.cs
```csharp
public class HomeController : Controller
{
    // ... (constructor)

    public IActionResult Index()
    {
        ????????????????????????????????????
        ? Check Session for CustomerId     ?
        ????????????????????????????????????
                 ?
        var customerId = HttpContext
            .Session.GetInt32("CustomerId");
                 ?
        ????????????????????????????????????
        ? If null (not logged in)          ?
        ????????????????????????????????????
                 ?
        if (customerId == null)
        {
            return RedirectToAction
                ("Login", "Account");
        }
                 ?
        ????????????????????????????????????
        ? If has value (logged in)         ?
        ????????????????????????????????????
                 ?
        return View();  // Show dashboard
    }
}
```

### AccountController.cs (Login)
```csharp
[HttpPost]
public async Task<IActionResult> Login(LoginViewModel model)
{
    ????????????????????????????????????????
    ? 1. Validate ModelState               ?
    ????????????????????????????????????????
             ?
    ????????????????????????????????????????
    ? 2. Authenticate user                 ?
    ?    await _authService.LoginAsync(...)?
    ????????????????????????????????????????
             ?
    ????????????????????????????????????????
    ? 3. Check if credentials are correct  ?
    ?    if (customer == null)             ?
    ????????????????????????????????????????
             ?
        NO ????? YES
            ?
            ?
      ????????????????
      ? Show error   ?
      ? Stay on      ?
      ? login page   ?
      ????????????????
                         ????????????????????????
                         ? 4. Set Session       ?
                         ? HttpContext.Session  ?
                         ? .SetInt32(...)       ?
                         ????????????????????????
                                   ?
                         ????????????????????????
                         ? 5. Redirect to Home  ?
                         ? return RedirectToAction
                         ? ("Index", "Home")    ?
                         ????????????????????????
}
```

### AccountController.cs (Logout)
```csharp
public IActionResult Logout()
{
    ??????????????????????????????????
    ? 1. Clear session               ?
    ? HttpContext.Session.Clear()    ?
    ??????????????????????????????????
             ?
    ??????????????????????????????????
    ? 2. Set success message         ?
    ? TempData["Success"] = "..."    ?
    ??????????????????????????????????
             ?
    ??????????????????????????????????
    ? 3. Redirect to Login page      ?
    ? return RedirectToAction(       ?
    ?     nameof(Login))             ?
    ??????????????????????????????????
             ?
    ??????????????????????????????????
    ? User is now logged out         ?
    ? Session = null                 ?
    ??????????????????????????????????
}
```

---

## ?? User Journey Map (B?n ?? hành trình ng??i dùng)

```
                        ???????????????
                        ?  New User?  ?
                        ???????????????
                              ?
                ??????????????????????????????
                ?                           ?
            YES ?                        NO ?
                ?                           ?
         ??????????????            ????????????????
         ? Sign Up    ?            ? Log In       ?
         ? Page       ?            ? Page         ?
         ??????????????            ????????????????
                ?                        ?
                ? Fill form              ? Enter credentials
                ? & register             ? & click Login
                ?                        ?
         ??????????????????????????????????
         ? Credentials Verified           ?
         ? Session Created                ?
         ??????????????????????????????????
                        ?
                        ?
         ???????????????????????????
         ? DASHBOARD DISPLAYED     ?
         ?                         ?
         ? ? Home                  ?
         ? ? Customer Management   ?
         ? ? Product Management    ?
         ? ? Invoice Management    ?
         ? ? Payment Management    ?
         ? ? ... More Features     ?
         ???????????????????????????
                ?
                ? User works
                ? (Session active)
                ?
           ????????????
           ?           ?
        YES?           ? NO
        Log?           ? Log
        out?           ? out
           ?           ?
           ?           ?
     ????????????? ????????????????
     ? Logout    ? ? Session      ?
     ? Success   ? ? Expires      ?
     ? Message   ? ? (30 min)     ?
     ????????????? ????????????????
           ?              ?
           ????????????????
                  ?
         ???????????????????
         ? Login Page      ?
         ? (Start Over)    ?
         ???????????????????
```

---

## ?? Testing Scenarios (Các k?ch b?n ki?m tra)

### Scenario 1: New Browser (No Session)
```
???????????????????????????????????????????
? 1. Open new incognito/private tab       ?
? 2. Type: http://localhost/              ?
?                                         ?
? EXPECTED RESULT:                        ?
? ? Dashboard NOT shown                   ?
? ? Redirected to login page             ?
? ? Can enter credentials                ?
???????????????????????????????????????????
```

### Scenario 2: Direct URL Access
```
???????????????????????????????????????????
? 1. With active session:                 ?
?    Type: http://localhost/Home/Index    ?
? ? ? Dashboard shown                     ?
?                                         ?
? 2. After logout:                        ?
?    Type: http://localhost/Home/Index    ?
? ? ? Redirected to login                 ?
???????????????????????????????????????????
```

### Scenario 3: Login Success
```
???????????????????????????????????????????
? 1. Enter valid credentials:             ?
?    Username: admin                      ?
?    Password: 123456                     ?
?                                         ?
? 2. Click "??ng Nh?p"                    ?
?                                         ?
? EXPECTED RESULT:                        ?
? ? Session created                      ?
? ? Redirected to dashboard              ?
? ? Welcome message shown                ?
???????????????????????????????????????????
```

### Scenario 4: Login Failure
```
???????????????????????????????????????????
? 1. Enter invalid credentials            ?
? 2. Click "??ng Nh?p"                    ?
?                                         ?
? EXPECTED RESULT:                        ?
? ? Error message shown:                 ?
?    "Username/Email or password          ?
?     is incorrect"                       ?
? ? Stayed on login page                 ?
? ? No session created                   ?
???????????????????????????????????????????
```

---

## ?? State Transitions (Các chuy?n ti?p tr?ng thái)

```
                    ????????????????????
                    ?   INITIAL STATE  ?
                    ?  Unauthenticated ?
                    ????????????????????
                            ?
                 ???????????????????????
                 ?                     ?
        Access / ?              Try    ?
        Home or  ?              Login  ?
        Other    ?                     ?
        Page     ?                     ?
                 ?            ?????????????????
                 ????? DENY ??? LOGIN SCREEN  ?
                       ?      ?  Username/PW  ?
                       ?      ?????????????????
                       ?              ?
                       ????????????????
                              ?
                  ?????????????????????????
                  ?                       ?
            Valid ?                 Invalid
            Creds ?                 Creds
                  ?                       ?
             ?????????????           Error
             ? LOGIN OK  ?          Message
             ? Set       ?              ?
             ? Session   ?              ???? Stay on
             ?????????????                   LOGIN SCREEN
                  ?
                  ?
         ???????????????????
         ?  AUTHENTICATED  ?
         ?   Session =     ?
         ?   Active        ?
         ???????????????????
                  ?
        ??????????????????????
        ?         ?          ?
    Can ?    Can  ?  Access  ?
    See ? Manage  ?  Other   ?
    All ?  Data   ?  Pages   ?
        ?         ?          ?
        ??????????????????????
                  ?
          Click   ?   Session
          Logout  ?   Timeout
                  ?   (30 min)
              ?????????
              ?       ?
              ?       ?
         ??????????????????????
         ?  LOGGED OUT /      ?
         ?  SESSION EXPIRED   ?
         ?                    ?
         ?  Redirect to       ?
         ?  Login Screen      ?
         ??????????????????????
              ?
              ??? Back to LOGIN SCREEN
```

---

## ? Ki?m Tra Danh Sách (Verification Checklist)

```
INSTALLATION & SETUP
?????????????????????
? Build successful (no compilation errors)
? Session configured in Program.cs
? HomeController modified to check session
? AccountController modified to redirect correctly

AUTHENTICATION
??????????????
? Login page works
? Register page works
? Demo account exists (admin/123456)
? Credentials verified correctly
? Session created after login
? Welcome message displayed

PROTECTION
??????????
? Home/Index requires login
? Direct URL access redirected to login
? All management pages protected
? Logout clears session
? Logout redirects to login

USER EXPERIENCE
???????????????
? Login page is clean and user-friendly
? Error messages are clear
? Success messages are displayed
? Navigation works correctly
? Responsive design maintained
```

---

## ?? Hoàn thành!

?ng d?ng c?a b?n bây gi? có:
- ? **B?o m?t**: Yêu c?u ??ng nh?p tr??c
- ? **Tr?i nghi?m ng??i dùng**: Rõ ràng và tr?c quan
- ? **Chuyên nghi?p**: Phù h?p v?i tiêu chu?n ?ng d?ng qu?n lý
- ? **S?n sàng**: Không có l?i, build thành công

**Tài kho?n Demo**: admin / 123456
